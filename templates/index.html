<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini AI æ™ºèƒ½è²¡å¯Œ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background-color: #0d1117; color: #c9d1d9; font-family: 'Segoe UI', system-ui, sans-serif; }
        .card { background: #161b22; border: 1px solid #30363d; border-radius: 16px; margin-bottom: 24px; transition: 0.3s; }
        .card:hover { border-color: #58a6ff; }
        .ai-input-section { background: linear-gradient(135deg, #1e3a8a 0%, #0d1117 100%); padding: 40px 0; border-bottom: 1px solid #30363d; margin-bottom: 40px; }
        .ai-input-wrapper { background: #0d1117; border: 2px solid #388bfd; border-radius: 50px; padding: 12px 25px; display: flex; align-items: center; box-shadow: 0 0 25px rgba(56, 139, 253, 0.2); }
        .ai-input-wrapper input { background: transparent; border: none; color: white; flex-grow: 1; outline: none; font-size: 1.2rem; }
        .btn-ai { background: #238636; color: white; border-radius: 30px; border: none; padding: 8px 25px; font-weight: bold; }
        .stat-value { font-size: 2.5rem; font-weight: 800; }
        .tag { font-size: 0.75rem; background: #21262d; color: #8b949e; padding: 4px 12px; border-radius: 20px; margin-right: 8px; border: 1px solid #30363d; }
    </style>
</head>
<body>

<div class="ai-input-section text-center">
    <div class="container">
        <h2 class="text-white fw-bold mb-4">ğŸ¤– æ‚¨å¥½ï¼Œæˆ‘æ˜¯ Gemini è²¡å¯ŒåŠ©æ‰‹</h2>
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="ai-input-wrapper">
                    <form action="/smart_input" method="POST" style="width: 100%; display: flex;">
                        <input type="text" name="raw_text" placeholder="å˜—è©¦è¼¸å…¥ï¼šè²· 2330 1å¼µ / ä¸­ä¿¡è½‰å°æ–° 3000 / æ™šé¤ -150" autocomplete="off" required>
                        <button type="submit" class="btn btn-ai">åˆ†æä¸¦è¨˜éŒ„</button>
                    </form>
                </div>
                <div class="mt-3">
                    <span class="tag">ğŸ’¡ è‚¡ç¥¨ï¼š2330 1000è‚¡</span>
                    <span class="tag">ğŸ’¡ è½‰å¸³ï¼šä¸­ä¿¡è½‰åœ‹æ³° 5000</span>
                    <span class="tag">ğŸ’¡ æ”¶æ”¯ï¼šå…¨è¯ -500</span>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container">
    <div class="row">
        <div class="col-lg-4">
            <div class="card p-4">
                <h6 class="text-muted fw-bold">ç¸½è³‡ç”¢ä¼°å€¼ (TWD)</h6>
                <div class="stat-value text-primary">${{ "{:,.0f}".format(total_cash + total_stock_value) }}</div>
                <hr style="border-color: #30363d;">
                <div class="d-flex justify-content-between mb-2">
                    <span>ç¾é‡‘ç¸½è¨ˆ</span><span class="text-white">${{ "{:,.0f}".format(total_cash) }}</span>
                </div>
                <div class="d-flex justify-content-between">
                    <span>è‚¡ç¥¨å¸‚å€¼</span><span class="text-success">${{ "{:,.0f}".format(total_stock_value) }}</span>
                </div>
            </div>
            
            <div class="card p-4">
                <h6 class="text-muted fw-bold mb-3">AI å»ºè­°å€åŸŸ</h6>
                <p id="ai-msg" class="small text-muted">æ­£åœ¨å„ªåŒ–æ‚¨çš„è³‡ç”¢é…ç½®...</p>
            </div>
        </div>

        <div class="col-lg-5">
            <div class="card p-4 h-100">
                <h6 class="text-muted fw-bold mb-4">è³‡ç”¢åˆ†é…æ¯”ä¾‹ (Portfolio)</h6>
                <div style="height: 250px;"><canvas id="donutChart"></canvas></div>
            </div>
        </div>

        <div class="col-lg-3">
            <div class="card p-4 h-100 text-center">
                <h6 class="text-muted fw-bold mb-4">æˆé•·è¶¨å‹¢ (Simulation)</h6>
                <canvas id="lineChart"></canvas>
                <div class="mt-4 small text-muted">è³‡ç”¢æ°´ä½å¥åº·åº¦ï¼š<br><strong class="text-info">å„ªè‰¯</strong></div>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-12">
            <div class="card p-4 shadow-sm">
                <h6 class="fw-bold mb-4 text-white">æ™ºæ…§åˆ†é¡æ˜ç´°è¡¨</h6>
                <div class="table-responsive">
                    <table class="table table-dark table-hover align-middle">
                        <thead class="text-muted">
                            <tr><th>é …ç›® / ä»£è™Ÿ</th><th>é¡å‹</th><th>é‡‘é¡ / å¸‚å€¼</th><th>æ“ä½œ</th></tr>
                        </thead>
                        <tbody>
                            {% for c in cash_items %}
                            <tr>
                                <td class="fw-bold text-white">{{ c[1] }}</td>
                                <td><span class="badge bg-primary opacity-75">ç¾é‡‘</span></td>
                                <td class="{{ 'text-danger' if c[2] < 0 else 'text-info' }} fw-bold">
                                    ${{ "{:,.2f}".format(c[2]) }}
                                </td>
                                <td><a href="/delete_cash/{{ c[0] }}" class="text-danger text-decoration-none">ç§»é™¤</a></td>
                            </tr>
                            {% endfor %}
                            {% for s in stocks %}
                            <tr>
                                <td class="fw-bold text-white">{{ s.symbol }}</td>
                                <td><span class="badge bg-success opacity-75">è­‰åˆ¸</span></td>
                                <td class="text-success fw-bold">${{ "{:,.2f}".format(s.value) }}</td>
                                <td><small class="text-muted">ç¾åƒ¹: {{ s.price }}</small></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const tc = {{ total_cash }};
    const ts = {{ total_stock_value }};
    const total = tc + ts;

    // 1. åˆ†é…åœ“é¤…åœ–
    new Chart(document.getElementById('donutChart'), {
        type: 'doughnut',
        data: {
            labels: ['ç¾é‡‘è³‡ç”¢', 'è­‰åˆ¸å¸‚å ´'],
            datasets: [{
                data: [tc, ts],
                backgroundColor: ['#388bfd', '#238636'],
                hoverOffset: 15,
                borderWidth: 0
            }]
        },
        options: { 
            maintainAspectRatio: false, 
            plugins: { legend: { position: 'bottom', labels: { color: '#8b949e' } } },
            cutout: '75%'
        }
    });

    // 2. æ¨¡æ“¬æˆé•·åœ–
    new Chart(document.getElementById('lineChart'), {
        type: 'line',
        data: {
            labels: ['1', '2', '3', 'Now'],
            datasets: [{ 
                data: [total*0.7, total*0.85, total*0.9, total], 
                borderColor: '#58a6ff', 
                backgroundColor: 'rgba(88, 166, 255, 0.1)',
                fill: true,
                tension: 0.4 
            }]
        },
        options: { plugins: { legend: { display: false } }, scales: { y: { display: false }, x: { display: false } } }
    });

    // 3. AI å»ºè­°é‚è¼¯
    const msg = document.getElementById('ai-msg');
    if (total > 0) {
        let r = (ts / total) * 100;
        if (r > 70) msg.innerText = "ğŸš¨ åµæ¸¬åˆ°é¢¨éšªï¼šæ‚¨çš„è­‰åˆ¸ä½”æ¯”é«˜é” " + r.toFixed(0) + "%ã€‚åœ¨å¸‚å ´é«˜ä½æ™‚ï¼Œå»ºè­°åˆ†æ‰¹è½‰å…¥ç¾é‡‘å¸³æˆ¶é¿éšªã€‚";
        else if (r < 20) msg.innerText = "ğŸ“ˆ åµæ¸¬åˆ°æ©Ÿæœƒï¼šç›®å‰ç¾é‡‘éå¤šï¼Œå»ºè­°åœ¨å›æª”æ™‚ä½ˆå±€å°è‚¡ 0050 ç­‰å¤§å‹æ¨™çš„ã€‚";
        else msg.innerText = "âœ… ç‹€æ…‹å¹³è¡¡ï¼šç›®å‰çš„è³‡ç”¢åˆ†é…éå¸¸ç©©å®šï¼Œé©åˆä½œç‚ºé•·æœŸè²¡å¯Œæˆé•·åŸºç¤ã€‚";
    }
</script>
</body>
</html>
