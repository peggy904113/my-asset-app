<!DOCTYPE html>
<html>
<head>
    <title>AI è³‡ç”¢ç®¡å®¶ Pro (è½‰å¸³ç·¨è¼¯ç‰ˆ)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background-color: #f8f9fc; }
        .card { border: none; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .transfer-box { background-color: #eef2ff; border: 1px dashed #4e73df; }
    </style>
</head>
<body>
    <div class="container py-4">
        <h2 class="text-center mb-4 text-primary fw-bold">æˆ‘çš„å…¨èƒ½è³‡ç”¢ç®¡å®¶</h2>

        <div class="row mb-4 text-center">
            <div class="col-md-4">
                <div class="card p-3">
                    <h6>è³‡ç”¢ä½”æ¯”</h6>
                    <canvas id="pieChart"></canvas>
                </div>
            </div>
            <div class="col-md-8">
                <div class="row">
                    <div class="col-6"><div class="card p-4"><h6>ç¾é‡‘</h6><h2 class="text-primary">${{ "{:,.0f}".format(total_cash) }}</h2></div></div>
                    <div class="col-6"><div class="card p-4"><h6>è‚¡ç¥¨</h6><h2 class="text-success">${{ "{:,.0f}".format(total_stock_value) }}</h2></div></div>
                </div>
                <div class="card p-3 transfer-box">
                    <h6 class="fw-bold">â†”ï¸ å¿«é€Ÿè½‰å¸³ (éŠ€è¡Œé–“ç§»å‹•)</h6>
                    <form action="/transfer" method="POST" class="row g-2">
                        <div class="col-4"><input type="text" name="from_bank" class="form-control form-control-sm" placeholder="è½‰å‡ºéŠ€è¡Œ"></div>
                        <div class="col-4"><input type="text" name="to_bank" class="form-control form-control-sm" placeholder="è½‰å…¥éŠ€è¡Œ"></div>
                        <div class="col-3"><input type="number" name="amount" class="form-control form-control-sm" placeholder="é‡‘é¡"></div>
                        <div class="col-1"><button class="btn btn-sm btn-dark">GO</button></div>
                    </form>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-4">
                <div class="card p-3 shadow">
                    <h6 id="form-title" class="fw-bold">ï¼‹ æ–°å¢/ç·¨è¼¯ç´€éŒ„</h6>
                    <form action="/save_cash" method="POST">
                        <input type="hidden" name="id" id="edit-id">
                        <input type="text" name="bank_name" id="edit-name" class="form-control mb-2" placeholder="éŠ€è¡Œåç¨±æˆ–é …ç›®" required>
                        <input type="number" step="any" name="amount" id="edit-amount" class="form-control mb-2" placeholder="é‡‘é¡" required>
                        <button type="submit" class="btn btn-primary w-100">å„²å­˜</button>
                        <button type="button" onclick="resetForm()" class="btn btn-link btn-sm w-100 text-muted mt-1">å–æ¶ˆç·¨è¼¯</button>
                    </form>
                </div>
            </div>

            <div class="col-md-8">
                <div class="card p-3">
                    <h6 class="fw-bold mb-3 text-muted">ç¾é‡‘æ”¶æ”¯æ˜ç´°</h6>
                    <table class="table table-hover">
                        <thead class="table-light"><tr><th>åç¨±</th><th>é‡‘é¡</th><th>æ“ä½œ</th></tr></thead>
                        <tbody>
                            {% for c in cash_items %}
                            <tr>
                                <td>{{ c[1] }}</td>
                                <td class="{{ 'text-danger fw-bold' if c[2] < 0 else 'text-dark' }}">${{ c[2] }}</td>
                                <td>
                                    <button class="btn btn-sm btn-outline-primary" onclick="editItem('{{ c[0] }}', '{{ c[1] }}', '{{ c[2] }}')">ç·¨è¼¯</button>
                                    <a href="/delete_cash/{{ c[0] }}" class="btn btn-sm btn-outline-danger">åˆªé™¤</a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // åœ–è¡¨æ•¸æ“š
        new Chart(document.getElementById('pieChart'), {
            type: 'doughnut',
            data: { labels: ['ç¾é‡‘', 'è‚¡ç¥¨'], datasets: [{ data: [{{ total_cash }}, {{ total_stock_value }}], backgroundColor: ['#4e73df', '#1cc88a'] }] }
        });

        // ç·¨è¼¯é‚è¼¯ï¼šå°‡è¡¨æ ¼è³‡æ–™å¡«å›è¡¨å–®
        function editItem(id, name, amount) {
            document.getElementById('edit-id').value = id;
            document.getElementById('edit-name').value = name;
            document.getElementById('edit-amount').value = amount;
            document.getElementById('form-title').innerText = "ğŸ“ æ­£åœ¨ç·¨è¼¯ç´€éŒ„";
            document.getElementById('form-title').classList.add("text-danger");
        }

        // é‡è¨­è¡¨å–®
        function resetForm() {
            document.getElementById('edit-id').value = "";
            document.getElementById('edit-name').value = "";
            document.getElementById('edit-amount').value = "";
            document.getElementById('form-title').innerText = "ï¼‹ æ–°å¢/ç·¨è¼¯ç´€éŒ„";
            document.getElementById('form-title').classList.remove("text-danger");
        }
    </script>
</body>
</html>                </div>
                <div class="card p-3">
                    <h6>ï¼‹ è¨˜éŒ„è‚¡ç¥¨</h6>
                    <form action="/add_trade" method="POST">
                        <input type="text" name="symbol" class="form-control mb-2" placeholder="ä»£è™Ÿ" required>
                        <input type="number" step="any" name="shares" class="form-control mb-2" placeholder="è‚¡æ•¸" required>
                        <button class="btn btn-success w-100">ç´€éŒ„</button>
                    </form>
                </div>
            </div>
            <div class="col-md-8">
                <div class="card p-3">
                    <canvas id="myPieChart" style="max-height: 200px;"></canvas>
                </div>
                <div class="card p-3 text-center">
                    <h6>è³‡ç”¢æ˜ç´°è¡¨</h6>
                    <table class="table table-sm">
                        <thead><tr><th>åç¨±</th><th>é¡å‹</th><th>é‡‘é¡</th></tr></thead>
                        <tbody>
                            {% for c in cash_items %}<tr><td>{{ c[1] }}</td><td>ç¾é‡‘</td><td>${{ c[2] }}</td></tr>{% endfor %}
                            {% for s in stocks %}<tr><td>{{ s.symbol }}</td><td>è‚¡ç¥¨</td><td>${{ s.value }}</td></tr>{% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        const cash = {{ total_cash }};
        const stock = {{ total_stock_value }};
        
        // ç•«åœ–
        new Chart(document.getElementById('myPieChart'), {
            type: 'doughnut',
            data: { labels: ['ç¾é‡‘', 'è‚¡ç¥¨'], datasets: [{ data: [cash, stock], backgroundColor: ['#4e73df', '#1cc88a'] }] }
        });

        // AI é‚è¼¯
        const msg = document.getElementById('ai-msg');
        if (cash + stock === 0) msg.innerText = "é–‹å§‹è¼¸å…¥è³‡æ–™ï¼Œæˆ‘æœƒç‚ºæ‚¨åˆ†æï¼";
        else if (stock > cash) msg.innerText = "è‚¡ç¥¨æ¯”ä¾‹è¼ƒé«˜ï¼Œæ³¨æ„å¸‚å ´æ³¢å‹•ã€‚";
        else msg.innerText = "è³‡ç”¢é…ç½®ç©©å¥ï¼Œç¹¼çºŒä¿æŒï¼";
    </script>
</body>
</html>                    </select>
                    <input type="number" step="any" name="amount" class="form-control mb-2" placeholder="é‡‘é¡ (æ”¯å‡ºè¼¸å…¥è² æ•¸)" required>
                    <button class="btn btn-primary w-100">å­˜æª”</button>
                </form>
            </div>
            
            <div class="card p-3">
                <h6 class="fw-bold text-success">ï¼‹ è¨˜éŒ„è­‰åˆ¸æŒè‚¡</h6>
                <form action="/add_trade" method="POST">
                    <input type="text" name="symbol" class="form-control mb-2" placeholder="ä»£è™Ÿ (å¦‚ 2330.TW)" required>
                    <input type="number" step="any" name="shares" class="form-control mb-2" placeholder="è‚¡æ•¸" required>
                    <button class="btn btn-success w-100">ç´€éŒ„</button>
                </form>
            </div>
        </div>

        <div class="col-lg-8">
            <div class="card p-3">
                <h6 class="fw-bold mb-3 text-muted">ç›®å‰æ‰€æœ‰æ˜ç´°</h6>
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-light"><tr><th>åç¨±/ä»£è™Ÿ</th><th>é¡å‹</th><th>ç¾å€¼</th><th>æ“ä½œ</th></tr></thead>
                        <tbody>
                            {% for c in cash_items %}
                            <tr><td>{{ c[1] }}</td><td>ç¾é‡‘</td><td>${{ c[2] }}</td><td><a href="/delete_cash/{{ c[0] }}" class="text-danger">åˆªé™¤</a></td></tr>
                            {% endfor %}
                            {% for s in stocks %}
                            <tr><td>{{ s.symbol }}</td><td>è‚¡ç¥¨</td><td class="text-success">${{ s.value }}</td><td>-</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // ç²å–æ•¸æ“š
    const cash = {{ total_cash }};
    const stock = {{ total_stock_value }};

    // 1. æ¯”ä¾‹åœ–
    new Chart(document.getElementById('pieChart'), {
        type: 'doughnut',
        data: {
            labels: ['ç¾é‡‘', 'è‚¡ç¥¨'],
            datasets: [{ data: [cash, stock], backgroundColor: ['#4e73df', '#1cc88a'] }]
        },
        options: { maintainAspectRatio: false }
    });

    // 2. æ¨¡æ“¬æˆé•·åœ–
    new Chart(document.getElementById('lineChart'), {
        type: 'line',
        data: {
            labels: ['1æœˆ', '2æœˆ', '3æœˆ', 'ä»Šæ—¥'],
            datasets: [{ label: 'è²¡å¯Œæˆé•·', data: [cash*0.8, cash*0.9, (cash+stock)*0.95, cash+stock], borderColor: '#4e73df', fill: true }]
        },
        options: { maintainAspectRatio: false }
    });

    // 3. AI åˆ†æé‚è¼¯
    let total = cash + stock;
    let text = "";
    if (total == 0) {
        text = "ç›®å‰é‚„æ²’æœ‰è³‡æ–™ï¼Œè«‹é–‹å§‹è¼¸å…¥æ‚¨çš„è³‡ç”¢ï¼Œè®“æˆ‘ç‚ºæ‚¨åˆ†æï¼";
    } else {
        let sp = (stock/total)*100;
        if (sp > 60) text = "ç›®å‰è‚¡ç¥¨æ¯”ä¾‹è¼ƒé«˜ (" + sp.toFixed(1) + "%)ï¼Œè‚¡å¸‚æ³¢å‹•æ™‚è«‹æ³¨æ„é¢¨éšªç®¡ç†ã€‚";
        else if (sp == 0) text = "è³‡ç”¢å…¨æ˜¯ç¾é‡‘ï¼Œé›–ç„¶ç©©å¥ä½†è¦æ³¨æ„é€šè†¨ï¼Œå¯è€ƒæ…®é…ç½®å°‘è¨± ETFã€‚";
        else text = "è³‡ç”¢é…ç½®ç›®å‰ç›¸ç•¶å¹³è¡¡ï¼Œç¹¼çºŒä¿æŒè‰¯å¥½çš„ç†è²¡ç¿’æ…£ï¼";
    }
    document.getElementById('ai-text').innerText = text;
</script>
</body>
</html>


