<!DOCTYPE html>
<html>
<head>
    <title>AI è³‡ç”¢ç®¡å®¶ Pro +</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { background-color: #f8f9fc; font-family: 'PingFang TC', sans-serif; }
        .navbar { background: linear-gradient(135deg, #4e73df 0%, #224abe 100%); color: white; padding: 20px; }
        .ai-box { background: #fff; border-left: 5px solid #f6c23e; border-radius: 10px; padding: 15px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .card { border: none; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .btn-primary { background-color: #4e73df; border: none; }
        .btn-success { background-color: #1cc88a; border: none; }
        .chart-container { position: relative; height: 250px; }
    </style>
</head>
<body>

<nav class="navbar mb-4 text-center">
    <div class="container"><h3>æ™ºèƒ½è³‡ç”¢ç¸½è¦½ç³»çµ±</h3></div>
</nav>

<div class="container">
    <div class="ai-box">
        <h6 class="fw-bold">ğŸ¤– AI ç†è²¡åŠ©ç†å»ºè­°ï¼š</h6>
        <p id="ai-text" class="mb-0 text-muted small">æ­£åœ¨è¨ˆç®—è³‡ç”¢æ¬Šé‡...</p>
    </div>

    <div class="row mb-4">
        <div class="col-lg-8">
            <div class="card p-3">
                <h6 class="fw-bold text-muted">è³‡ç”¢æˆé•·è¶¨å‹¢ (æ¨¡æ“¬)</h6>
                <div class="chart-container"><canvas id="lineChart"></canvas></div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="card p-3">
                <h6 class="fw-bold text-muted">è³‡ç”¢åˆ†ä½ˆæ¯”ç‡</h6>
                <div class="chart-container"><canvas id="pieChart"></canvas></div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-4">
            <div class="card p-3">
                <h6 class="fw-bold text-primary">ï¼‹ æ–°å¢ç¾é‡‘ / æ”¯å‡º</h6>
                <form action="/add_cash" method="POST">
                    <input type="text" name="bank_name" class="form-control mb-2" placeholder="é …ç›® (å¦‚:ä¸­ä¿¡/æˆ¿ç§Ÿ)" required>
                    <select name="currency" class="form-select mb-2">
                        <option value="TWD">TWD (å°å¹£)</option>
                        <option value="USD">USD (ç¾é‡‘)</option>
                    </select>
                    <input type="number" step="any" name="amount" class="form-control mb-2" placeholder="é‡‘é¡ (æ”¯å‡ºè¼¸å…¥è² æ•¸)" required>
                    <button class="btn btn-primary w-100">å­˜æª”</button>
                </form>
            </div>
            
            <div class="card p-3">
                <h6 class="fw-bold text-success">ï¼‹ è¨˜éŒ„è­‰åˆ¸æŒè‚¡</h6>
                <form action="/add_trade" method="POST">
                    <input type="text" name="symbol" class="form-control mb-2" placeholder="ä»£è™Ÿ (å¦‚ 2330.TW)" required>
                    <input type="number" step="any" name="shares" class="form-control mb-2" placeholder="è‚¡æ•¸" required>
                    <button class="btn btn-success w-100">ç´€éŒ„</button>
                </form>
            </div>
        </div>

        <div class="col-lg-8">
            <div class="card p-3">
                <h6 class="fw-bold mb-3 text-muted">ç›®å‰æ‰€æœ‰æ˜ç´°</h6>
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-light"><tr><th>åç¨±/ä»£è™Ÿ</th><th>é¡å‹</th><th>ç¾å€¼</th><th>æ“ä½œ</th></tr></thead>
                        <tbody>
                            {% for c in cash_items %}
                            <tr><td>{{ c[1] }}</td><td>ç¾é‡‘</td><td>${{ c[2] }}</td><td><a href="/delete_cash/{{ c[0] }}" class="text-danger">åˆªé™¤</a></td></tr>
                            {% endfor %}
                            {% for s in stocks %}
                            <tr><td>{{ s.symbol }}</td><td>è‚¡ç¥¨</td><td class="text-success">${{ s.value }}</td><td>-</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // ç²å–æ•¸æ“š
    const cash = {{ total_cash }};
    const stock = {{ total_stock_value }};

    // 1. æ¯”ä¾‹åœ–
    new Chart(document.getElementById('pieChart'), {
        type: 'doughnut',
        data: {
            labels: ['ç¾é‡‘', 'è‚¡ç¥¨'],
            datasets: [{ data: [cash, stock], backgroundColor: ['#4e73df', '#1cc88a'] }]
        },
        options: { maintainAspectRatio: false }
    });

    // 2. æ¨¡æ“¬æˆé•·åœ–
    new Chart(document.getElementById('lineChart'), {
        type: 'line',
        data: {
            labels: ['1æœˆ', '2æœˆ', '3æœˆ', 'ä»Šæ—¥'],
            datasets: [{ label: 'è²¡å¯Œæˆé•·', data: [cash*0.8, cash*0.9, (cash+stock)*0.95, cash+stock], borderColor: '#4e73df', fill: true }]
        },
        options: { maintainAspectRatio: false }
    });

    // 3. AI åˆ†æé‚è¼¯
    let total = cash + stock;
    let text = "";
    if (total == 0) {
        text = "ç›®å‰é‚„æ²’æœ‰è³‡æ–™ï¼Œè«‹é–‹å§‹è¼¸å…¥æ‚¨çš„è³‡ç”¢ï¼Œè®“æˆ‘ç‚ºæ‚¨åˆ†æï¼";
    } else {
        let sp = (stock/total)*100;
        if (sp > 60) text = "ç›®å‰è‚¡ç¥¨æ¯”ä¾‹è¼ƒé«˜ (" + sp.toFixed(1) + "%)ï¼Œè‚¡å¸‚æ³¢å‹•æ™‚è«‹æ³¨æ„é¢¨éšªç®¡ç†ã€‚";
        else if (sp == 0) text = "è³‡ç”¢å…¨æ˜¯ç¾é‡‘ï¼Œé›–ç„¶ç©©å¥ä½†è¦æ³¨æ„é€šè†¨ï¼Œå¯è€ƒæ…®é…ç½®å°‘è¨± ETFã€‚";
        else text = "è³‡ç”¢é…ç½®ç›®å‰ç›¸ç•¶å¹³è¡¡ï¼Œç¹¼çºŒä¿æŒè‰¯å¥½çš„ç†è²¡ç¿’æ…£ï¼";
    }
    document.getElementById('ai-text').innerText = text;
</script>
</body>
</html>
